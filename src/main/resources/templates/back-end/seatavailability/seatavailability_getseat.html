<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">

<head>
<meta charset="UTF-8" />
<title>æŸ¥è©¢æ¥é§åº§ä½ | å¾Œå°ç®¡ç†</title>

<!-- å¼•å…¥å¾Œå°æ¨£å¼ -->
<th:block th:replace="~{fragments/backFragments :: styles}"></th:block>

<script>
	function autoSubmit(id) {
		document.getElementById(id).submit();
	}

	function redirectToResult() {
		const scheduleId = document.getElementById("scheduleId").value;
		const selectedDate = document.getElementById("selectedDate").value;
		if (scheduleId && selectedDate) {
			window.location.href = `/backend/seatavailability/get/${scheduleId}/${selectedDate}`;
		}
	}
</script>
</head>

<body>
	<!-- è¼‰å…¥å´é‚Šæ¬„ -->
	<div th:replace="~{fragments/backFragments :: mobileSidebar}"></div>
	<div th:replace="~{fragments/backFragments :: sidebar}"></div>

	<!-- ä¸»å…§å®¹ -->
	<main
		th:replace="~{fragments/backFragments :: mainContent(~{::myContent})}">
		<th:block th:fragment="myContent">

			<h2 class="mb-4">ğŸ” å‰©é¤˜åº§ä½æŸ¥è©¢</h2>

			<!-- æŸ¥è©¢è¡¨å–® -->
			<form id="dateForm" th:action="@{/backend/seatavailability/getseat}"
				method="get" class="mb-3">
				<label for="date" class="form-label">é¸æ“‡æ—¥æœŸï¼š</label> <select id="date"
					name="date" class="form-select" required
					onchange="autoSubmit('dateForm')">
					<option value="">è«‹é¸æ“‡æ—¥æœŸ</option>
					<option th:each="d : ${availableDates}" th:value="${d}"
						th:text="${d}" th:selected="${d} == ${selectedDate}"></option>
				</select>
			</form>

			<!-- è¿”å›åˆ—è¡¨æŒ‰éˆ• -->
			<div class="mb-3">
				<a class="btn btn-secondary" th:href="@{/backend/seatavailability/list}">è¿”å›åˆ—è¡¨</a>
			</div>

			<!-- ç­æ¬¡é¸æ“‡ -->
			<div th:if="${selectedDate != null}" class="mb-4">
				<input type="hidden" id="selectedDate" th:value="${selectedDate}" />
				<label for="scheduleId" class="form-label">é¸æ“‡ç­æ¬¡ï¼š</label> <select
					id="scheduleId" name="scheduleId" class="form-select mb-3" required
					onchange="redirectToResult()">
					<option value="">è«‹é¸æ“‡ç­æ¬¡</option>
					<option th:each="s : ${scheduleForSelectedDate}"
						th:value="${s.shuttleScheduleId}"
						th:text="'ç­æ¬¡ ' + ${s.shuttleScheduleId} + 'ï¼ˆ' 
                                + (${s.shuttleSchedule.shuttleDirection == 0 ? 'å»ç¨‹' : 'å›ç¨‹'}) + 'ï½œ' 
                                + ${#temporals.format(s.shuttleSchedule.shuttleDepartureTime, 'HH:mm')} + ' - ' 
                                + ${#temporals.format(s.shuttleSchedule.shuttleArrivalTime, 'HH:mm')} + ')' "
						th:selected="${s.shuttleScheduleId} == ${selectedScheduleId}">
					</option>
				</select>
			</div>

			<!-- éŒ¯èª¤è¨Šæ¯ -->
			<div th:if="${errorMSG != null}" class="alert alert-danger">
				<i class="fa-solid fa-triangle-exclamation me-1"></i> <span
					th:text="${errorMSG}"></span>
			</div>

			<!-- æŸ¥è©¢çµæœ -->
			<div class="card shadow-sm p-4" th:if="${seat != null}">
				<div class="card-body text-start">

					<p>
						<strong>ç­æ¬¡ï¼š</strong> <span th:text="${seat.shuttleScheduleId}"></span>
					</p>
					<hr>

					<p>
						<strong>æ—¥æœŸï¼š</strong> <span th:text="${seat.shuttleDate}"></span>
					</p>
					<hr>

					<p>
						<strong>æ™‚æ®µï¼š</strong> <span
							th:text="${#temporals.format(seat.shuttleSchedule.shuttleDepartureTime, 'HH:mm')} 
                                + ' â†’ ' + 
                                ${#temporals.format(seat.shuttleSchedule.shuttleArrivalTime, 'HH:mm')}">
						</span>
					</p>
					<hr>

					<p>
						<strong>å»å›ç¨‹ï¼š</strong> <span
							th:text="${seat.shuttleSchedule.shuttleDirection == 0 ? 'å»ç¨‹' : 'å›ç¨‹'}"></span>
					</p>
					<hr>

					<p>
						<strong>å¯ç”¨åº§ä½æ•¸ï¼š</strong> <span th:text="${seat.seatQuantity}"></span>
					</p>
					<hr>

					<p>
						<strong>æ›´æ–°æ™‚é–“ï¼š</strong> <span
							th:text="${#temporals.format(seat.seatUpdatedAt, 'yyyy-MM-dd HH:mm')}"></span>
					</p>
				</div>
			</div>

		</th:block>
	</main>
</body>

</html>
