<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>åº§ä½ç‹€æ³åˆ—è¡¨ | Isle Villa å¾Œå°</title>

<th:block th:replace="~{fragments/backFragments :: styles}"></th:block>
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

<style>
/* çµ±ä¸€é«˜åº¦å®¹å™¨ */
.unified-height {
	height: 32px;
}

/* æœå°‹æ¬„å¤–å±¤å®¹å™¨ï¼ˆå« iconï¼‰ */
.search-wrapper {
	display: flex;
	align-items: center;
	border: 1px solid #ced4da;
	border-radius: 6px;
	background-color: #fff;
	width: 180px;
	overflow: hidden;
}

/* æ”¾å¤§é¡ icon */
.search-wrapper .search-icon {
	padding: 0.6rem 0.75rem;
	color: #6c757d;
	font-size: 1.1rem;
	background-color: #f8f9fa;
	border-right: 1px solid #ced4da;
}

/* è¼¸å…¥æ¡† */
.search-wrapper .search-input {
	border: none;
	outline: none;
	box-shadow: none;
	padding: 0.55rem 0.75rem;
	font-size: 0.9rem;
	flex-grow: 1;
}
</style>
</head>
<body>
	<th:block th:replace="~{fragments/backFragments :: mobileSidebar}"></th:block>
	<div th:replace="~{fragments/backFragments :: sidebar}"></div>

	<main
		th:replace="~{fragments/backFragments :: mainContent(~{::myContent})}">
		<th:block th:fragment="myContent">
			<div class="card-header bg-transparent border-0 pt-4 pb-2">
				<div
					class="d-flex justify-content-between align-items-center flex-wrap">
					<h4 class="card-title fw-bold mb-0">
						<i class="bi bi-grid-fill me-2"></i>åº§ä½ç‹€æ³åˆ—è¡¨
					</h4>
					<a class="btn btn-success"
						th:href="@{/backend/seatavailability/add}"> <i
						class="bi bi-plus-circle me-1"></i>æ–°å¢åº§ä½
					</a>
				</div>
			</div>

			<div class="card-body">
				<div class="filter-section row gx-3 gy-2 align-items-center">

					<!-- æ—¥æœŸé¸å–® -->
					<div class="col-auto d-flex align-items-center gap-2">
						<select id="dateFilter" class="form-select custom-filter-lg">
							<option value="">å…¨éƒ¨æ—¥æœŸ</option>
							<option th:each="date : ${availableDates}" th:value="${date}"
								th:text="${date}"></option>
						</select>
					</div>

					<!-- æ™‚æ®µæœå°‹ -->
					<div class="col-auto d-flex align-items-center gap-2">
						<div class="search-wrapper custom-filter-lg">
							<i class="fa-solid fa-magnifying-glass search-icon"></i> <input
								type="text" id="scheduleInput" class="form-control search-input"
								placeholder="è«‹è¼¸å…¥æ™‚æ®µç·¨è™Ÿ" />
						</div>
					</div>

				</div>
			</div>
			<div class="table-responsive">
				<table class="table table-hover text-center align-middle"
					id="seatTable">
					<thead>
						<tr>
							<th class="text-center">æ—¥æœŸ</th>
							<th class="text-center">æ™‚æ®µè³‡è¨Š</th>
							<th class="text-center">å¯ç”¨åº§ä½</th>
							<th class="text-center">æœ€å¾Œæ›´æ–°æ™‚é–“</th>
							<th class="text-center">æ“ä½œ</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="seat : ${seatavailability}">
							<td
								th:text="${#temporals.format(seat.shuttleDate, 'yyyy-MM-dd')}"></td>
							<td
								th:text="'#' + ${seat.shuttleSchedule.shuttleScheduleId} + 'ï½œ' + (${seat.shuttleSchedule.shuttleDirection == 0 ? 'å»ç¨‹' : 'å›ç¨‹'}) + ' ' + ${#temporals.format(seat.shuttleSchedule.shuttleDepartureTime, 'HH:mm')} + ' ~ ' + ${#temporals.format(seat.shuttleSchedule.shuttleArrivalTime, 'HH:mm')}"></td>
							<td th:text="${seat.seatQuantity}"></td>
							<td
								th:text="${#temporals.format(seat.seatUpdatedAt, 'yyyy-MM-dd HH:mm')}"></td>
							<td>
								<div class="d-flex justify-content-center gap-1 flex-wrap">
									<a class="btn btn-sm btn-primary"
										th:href="@{'/backend/seatavailability/edit/' + ${seat.shuttleScheduleId} + '/' + ${#temporals.format(seat.shuttleDate, 'yyyy-MM-dd')} }">
										<i class="bi bi-pencil me-1"></i>ç·¨è¼¯
									</a> <a class="btn btn-sm btn-danger"
										th:href="@{'/backend/seatavailability/delete/' + ${seat.shuttleScheduleId} + '/' + ${#temporals.format(seat.shuttleDate, 'yyyy-MM-dd')} }"
										onclick="return confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ');"> <i
										class="bi bi-trash me-1"></i>åˆªé™¤
									</a>
								</div>
							</td>
						</tr>
						<tr th:if="${#lists.isEmpty(seatavailability)}">
							<td colspan="5" class="text-center">å°šç„¡åº§ä½ç‹€æ³è³‡æ–™</td>
						</tr>
					</tbody>
				</table>
			</div>
		</th:block>
	</main>

	<th:block th:replace="~{fragments/backFragments :: scripts}"></th:block>
	<script
		src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script
		src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
	<script>
		$(document).ready(
				function() {
					const table = $('#seatTable').DataTable({
						dom : "t<'my-3'p>",
						pagingType : 'simple_numbers',
						lengthChange : false,
						info : false,
						autoWidth : false,
						language : {
							paginate : {
								previous : 'ä¸Šä¸€é ',
								next : 'ä¸‹ä¸€é '
							}
						}
					});

					// ğŸ” æ ¹æ“šã€Œæ—¥æœŸ + æ™‚æ®µè¼¸å…¥ã€è¯åˆéæ¿¾
					$('#dateFilter, #scheduleInput').on('input change', function () {
					  const selectedDate = $('#dateFilter').val();
					  const keyword = $('#scheduleInput').val().trim();
					
					  $.fn.dataTable.ext.search.push(function (settings, data) {
					    const rowDate = data[0];      // ç¬¬ 0 æ¬„ï¼šæ—¥æœŸ
					    const rowSchedule = data[1];  // ç¬¬ 1 æ¬„ï¼š#12ï½œå»ç¨‹ 08:00 ~ 09:00
					
					    // æ“·å– # å¾Œçš„ç·¨è™Ÿï¼ˆå»æ‰ "#" å’Œ "ï½œ" å¾Œé¢çš„æ–‡å­—ï¼‰
					    const scheduleId = rowSchedule.split('ï½œ')[0].replace('#', '').trim(); // ä¾‹å¦‚ "12"
					
					    const matchDate = !selectedDate || rowDate === selectedDate;
					    const matchSchedule = !keyword || scheduleId === keyword;
					
					    return matchDate && matchSchedule;
					  });
					
					  table.draw();
					  $.fn.dataTable.ext.search.pop();
					});
				});
	</script>
</body>
</html>